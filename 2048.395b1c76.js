let t;var e={};const s=new class{constructor(t=this.getInitialState()){this.state=t,this.score=0,this.status="idle"}moveLeft(){this.moveInline("left")}moveRight(){this.moveInline("right")}moveUp(){this.moveBlock("up")}moveDown(){this.moveBlock("down")}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.score=0,this.status="playing",this.addRandomSell(),this.addRandomSell()}restart(){this.status="idle",this.score=0,this.state=this.getInitialState()}moveBlock(t){if("playing"===this.getStatus()){let e=!1;this.state.forEach((s,a)=>{let o=[];s.forEach((t,e)=>{o.push(this.state[e][a])});let i=this.getNotEmptyCells(o,t);i=this.mergeCells(i,t);for(let t=0;t<4;t++)this.state[t][a]=i[t]||0,this.state[t][a]!==o[t]&&(e=!0)}),e&&(this.addRandomSell(),this.checkWinLose())}}moveInline(t){if("playing"===this.getStatus()){let e;this.state.forEach(s=>{let a=[...s],o=this.getNotEmptyCells(s,t);o=this.mergeCells(o,t),s.forEach((t,e)=>{s[e]=o[e]||0}),a.every((t,e)=>t===s[e])||(e=!0)}),e&&(this.addRandomSell(),this.checkWinLose())}}getInitialState(){return[,,,,].fill(0).map(()=>[,,,,].fill(0))}addRandomSell(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.state[e][s]&&t.push([e,s]);let e=Math.floor(Math.random()*t.length),s=.9>Math.random()?2:4,[a,o]=t[e];this.state[a][o]=s}getNotEmptyCells(t,e){let s=t.filter(t=>t>0);if("right"===e||"down"===e)for(;s.length<4;)s.unshift(0);if("left"===e||"up"===e)for(;s.length<4;)s.push(0);return s}mergeCells(t,e){for(let e=0;e<t.length-1;e++){let s=t[e],a=t[e+1];s===a&&s>0&&(this.score+=s+a,t[e]=s+a,t.splice(e+1,1))}return"right"===e||"down"===e?this.getNotEmptyCells(t,e):t}hasMove(){for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this.state[t][e];if(0===s||(t<3?this.state[t+1][e]:0)===s||(e<3?this.state[t][e+1]:0)===s)return!0}return!1}checkWinLose(){this.state.some(t=>t.includes(2048))&&(this.status="win"),this.hasMove()||(this.status="lose")}},a=document.querySelector(".button.start"),o=document.querySelector(".message-start"),i=document.querySelector(".message-win"),l=document.querySelector(".message-lose"),r=document.querySelector(".game-score"),n=document.querySelector(".game-score-add");function h(){let e=s.getState(),a=document.querySelectorAll(".field-row"),o=+r.textContent||0,h=s.getScore(),d=h-o;d>0&&"idle"!==s.getStatus()&&(n.classList.remove("game-score-add--move"),n.offsetWidth,clearTimeout(t),n.textContent=`+${d}`,n.classList.add("game-score-add--move"),t=setTimeout(()=>{n.classList.remove("game-score-add--move")},500)),r.textContent=h,e.forEach((t,e)=>{t.forEach((t,s)=>{let o=a[e].children[s];o.className="field-cell",o.textContent="",t>0&&(o.textContent=t,o.classList.add(`field-cell--${t}`))})}),"win"===s.getStatus()?i.classList.remove("hidden"):"lose"===s.getStatus()&&l.classList.remove("hidden")}a.addEventListener("click",()=>{"idle"===s.getStatus()?(s.start(),a.classList.remove("start"),a.classList.add("restart"),a.textContent="Restart",o.classList.add("hidden")):(a.classList.remove("restart"),a.classList.add("start"),a.textContent="Start",o.classList.remove("hidden"),l.classList.add("hidden"),i.classList.add("hidden"),s.restart()),h()}),document.addEventListener("keydown",t=>{switch(t.key){case"ArrowLeft":s.moveLeft();break;case"ArrowRight":s.moveRight();break;case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown()}h()});
//# sourceMappingURL=2048.395b1c76.js.map
