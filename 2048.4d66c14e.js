!function(){"use strict";var t,e={};function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function n(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(t,e)}}var a=new(function(){var t;function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getInitialState();if(!(this instanceof e))throw TypeError("Cannot call a class as a function");this.state=t,this.score=0,this.status="idle"}return t=[{key:"moveLeft",value:function(){this.moveInline("left")}},{key:"moveRight",value:function(){this.moveInline("right")}},{key:"moveUp",value:function(){this.moveBlock("up")}},{key:"moveDown",value:function(){this.moveBlock("down")}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.state}},{key:"getStatus",value:function(){return this.status}},{key:"start",value:function(){this.score=0,this.status="playing",this.addRandomSell(),this.addRandomSell()}},{key:"restart",value:function(){this.status="idle",this.score=0,this.state=this.getInitialState()}},{key:"moveBlock",value:function(t){var e=this;if("playing"===this.getStatus()){var r=!1;this.state.forEach(function(n,a){var o=[];n.forEach(function(t,r){o.push(e.state[r][a])});var s=e.getNotEmptyCells(o,t);s=e.mergeCells(s,t);for(var i=0;i<4;i++)e.state[i][a]=s[i]||0,e.state[i][a]!==o[i]&&(r=!0)}),r&&(this.addRandomSell(),this.checkWinLose())}}},{key:"moveInline",value:function(t){var e,a=this;"playing"===this.getStatus()&&(this.state.forEach(function(o){var s=function(t){if(Array.isArray(t))return r(t)}(o)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(o)||n(o)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),i=a.getNotEmptyCells(o,t);i=a.mergeCells(i,t),o.forEach(function(t,e){o[e]=i[e]||0}),s.every(function(t,e){return t===o[e]})||(e=!0)}),e&&(this.addRandomSell(),this.checkWinLose()))}},{key:"getInitialState",value:function(){return[,,,,].fill(0).map(function(){return[,,,,].fill(0)})}},{key:"addRandomSell",value:function(){for(var t,e=[],r=0;r<4;r++)for(var a=0;a<4;a++)0===this.state[r][a]&&e.push([r,a]);var o=Math.floor(Math.random()*e.length),s=.9>Math.random()?2:4,i=function(t){if(Array.isArray(t))return t}(t=e[o])||function(t,e){var r,n,a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var o=[],s=!0,i=!1;try{for(a=a.call(t);!(s=(r=a.next()).done)&&(o.push(r.value),o.length!==e);s=!0);}catch(t){i=!0,n=t}finally{try{s||null==a.return||a.return()}finally{if(i)throw n}}return o}}(t,2)||n(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),l=i[0],u=i[1];this.state[l][u]=s}},{key:"getNotEmptyCells",value:function(t,e){var r=t.filter(function(t){return t>0});if("right"===e||"down"===e)for(;r.length<4;)r.unshift(0);if("left"===e||"up"===e)for(;r.length<4;)r.push(0);return r}},{key:"mergeCells",value:function(t,e){for(var r=0;r<t.length-1;r++){var n=t[r],a=t[r+1];n===a&&n>0&&(this.score+=n+a,t[r]=n+a,t.splice(r+1,1))}return"right"===e||"down"===e?this.getNotEmptyCells(t,e):t}},{key:"hasMove",value:function(){for(var t=0;t<4;t++)for(var e=0;e<4;e++){var r=this.state[t][e];if(0===r||(t<3?this.state[t+1][e]:0)===r||(e<3?this.state[t][e+1]:0)===r)return!0}return!1}},{key:"checkWinLose",value:function(){this.state.some(function(t){return t.includes(2048)})&&(this.status="win"),this.hasMove()||(this.status="lose")}}],function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e.prototype,t),e}()),o=document.querySelector(".button.start"),s=document.querySelector(".message-start"),i=document.querySelector(".message-win"),l=document.querySelector(".message-lose"),u=document.querySelector(".game-score"),c=document.querySelector(".game-score-add");function f(){var e=a.getState(),r=document.querySelectorAll(".field-row"),n=+u.textContent||0,o=a.getScore(),s=o-n;s>0&&"idle"!==a.getStatus()&&(c.classList.remove("game-score-add--move"),c.offsetWidth,clearTimeout(t),c.textContent="+".concat(s),c.classList.add("game-score-add--move"),t=setTimeout(function(){c.classList.remove("game-score-add--move")},500)),u.textContent=o,e.forEach(function(t,e){t.forEach(function(t,n){var a=r[e].children[n];a.className="field-cell",a.textContent="",t>0&&(a.textContent=t,a.classList.add("field-cell--".concat(t)))})}),"win"===a.getStatus()?i.classList.remove("hidden"):"lose"===a.getStatus()&&l.classList.remove("hidden")}o.addEventListener("click",function(){"idle"===a.getStatus()?(a.start(),o.classList.remove("start"),o.classList.add("restart"),o.textContent="Restart",s.classList.add("hidden")):(o.classList.remove("restart"),o.classList.add("start"),o.textContent="Start",s.classList.remove("hidden"),l.classList.add("hidden"),i.classList.add("hidden"),a.restart()),f()}),document.addEventListener("keydown",function(t){switch(t.key){case"ArrowLeft":a.moveLeft();break;case"ArrowRight":a.moveRight();break;case"ArrowUp":a.moveUp();break;case"ArrowDown":a.moveDown()}f()})}();
//# sourceMappingURL=2048.4d66c14e.js.map
